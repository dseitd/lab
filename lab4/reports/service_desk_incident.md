# ЛР4 — Имитация инцидента (Service Desk)

## 1. Приоритет инцидента
- Тип: массовый сбой входа в критичной для учебного процесса системе.
- Влияние: высокая бизнес‑критичность (12 преподавателей не могут начать уроки).
- Срочность: высокая (утро понедельника, начало учебной недели).
- Приоритет: P1 (Critical) — немедленная реакция, эскалация и восстановление.

## 2. Возможные причины
- Аутентификация:
  - Смена политики паролей/соли без миграции хэшей → «Неверный пароль».
  - Массовый сброс/истечение паролей, рассинхронизация сессий.
- Инфраструктура:
  - Недоступность БД (SQLite/файловая блокировка), перегрузка диска/FS → «Сервер недоступен».
  - Падение процесса веб‑сервера, конфликт портов, firewall/прокси.
- Сеть:
  - Проблемы локальной сети/маршрутизации, DNS, фильтрация трафика.
- Приложение:
  - Деплой без миграций, несовместимость версий зависимостей, регрессия.

## 3. План диагностики
1) Подтвердить масштаб: количество затронутых пользователей, география, время.
2) Проверить доступность веб‑сервера (HTTP 200 на /login), логи процесса.
3) Проверить доступность БД/файла SQLite: права, блокировки, размер, место на диске.
4) Проверить последние изменения: деплой/настройки/секреты, конфигурацию сессий.
5) Провести контрольный вход тестовым аккаунтом; сравнить хэш пароля.
6) Проверить сеть: ping/trace к серверу, статус DNS, прокси/фаервол.
7) Сегментировать инцидент: пользователи с «Неверный пароль» vs «Сервер недоступен».
8) Эскалация при подтверждении P1: уведомить ИТ‑дежурного, администратора БД/сети.

## 4. Карточки инцидента
- Индивидуальная ошибка («Неверный пароль»):
  - Симптом: единичные пользователи, успешный вход у других.
  - Гипотезы: неверный ввод, истёкший/сброшенный пароль, рассинхронизация хэшей.
  - Действия: сброс пароля, проверка хэша, очистка сессии, аудит попыток входа.
- Массовая ошибка («Сервер недоступен»):
  - Симптом: множественные пользователи одновременно не могут открыть сайт.
  - Гипотезы: падение сервиса, блокировка БД, сеть/прокси, исчерпанные ресурсы.
  - Действия: перезапуск сервиса, снятие блокировок, проверка доступности порта, сетевой аудит.

## 5. Временное решение (workaround)
- Для «Неверный пароль»: оперативный сброс пароля через Service Desk, временная выдача одноразовых паролей, инструкция по входу.
- Для «Сервер недоступен»: переключение на резервный узел/порт, перезапуск процесса, публикация статуса и ETA восстановления.

## 6. Окончательное решение
- Восстановить доступность сервера: устранить причину (ресурсы/падение процесса/сеть).
- Провести миграцию/синхронизацию хэшей паролей при изменении политики.
- Добавить мониторинг:
  - health‑check /login и /dashboard (HTTP), алёрты по недоступности.
  - контроль размера/блокировок SQLite, ротацию логов.
  - лимит попыток входа, защита от брутфорса.
- Внедрить процедуру деплоя с чек‑листом: миграции, секреты, smoke‑тесты.

## 7. Время реакции и устранения
- Время обнаружения: 08:05 (первое обращение).
- Начало реакции: 08:07 (регистрация инцидента P1, сбор симптомов).
- Временное решение: 08:15 (перезапуск сервиса, одноразовые пароли).
- Полное восстановление: 08:40 (устранение причины «Сервер недоступен»).
- Пост‑инцидентный отчёт: 10:00 (итоговый анализ, меры предотвращения).
